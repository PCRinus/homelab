name: Cleanup Docker Resources

on:
  schedule:
    # Run every Wednesday and Sunday at 2 AM UTC
    - cron: '0 2 * * 0,3'
  workflow_dispatch:
    inputs:
      cleanup_mode:
        description: 'Cleanup mode'
        required: false
        type: choice
        options:
          - dangling
          - images
          - full
        default: 'images'

jobs:
  cleanup:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v6

      - name: Cleanup Docker Resources
        uses: ./.github/actions/cleanup-docker
        with:
          cleanup_mode: ${{ inputs.cleanup_mode || 'images' }}
          ssh_host: ${{ vars.HOMELAB_SSH_HOST || 'homeserver' }}
          ts_oauth_client_id: ${{ secrets.TS_OAUTH_CLIENT_ID }}
          ts_oauth_secret: ${{ secrets.TS_OAUTH_SECRET }}
          ssh_private_key: ${{ secrets.SSH_PRIVATE_KEY }}
          ssh_user: ${{ secrets.SSH_USER }}
