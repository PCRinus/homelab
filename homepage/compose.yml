services:
  homepage:
    image: ghcr.io/gethomepage/homepage:v1.9
    container_name: homepage
    restart: unless-stopped
    env_file:
      - ../.env
    ports:
      - 3000:3000
    volumes:
      # Versioned configs - read-only
      - ./services.yaml:/app/config/services.yaml:ro
      - ./settings.yaml:/app/config/settings.yaml:ro
      - ./bookmarks.yaml:/app/config/bookmarks.yaml:ro
      - ./docker.yaml:/app/config/docker.yaml:ro
      - ./widgets.yaml:/app/config/widgets.yaml:ro
      - ./custom.css:/app/config/custom.css:ro
      - ./custom.js:/app/config/custom.js:ro
      - ./kubernetes.yaml:/app/config/kubernetes.yaml:ro
      - ./proxmox.yaml:/app/config/proxmox.yaml:ro
      # Container-writable data - not versioned
      - /home/mircea/docker/homepage/logs:/app/config/logs
      # Other mounts
      - /run/user/1000/docker.sock:/var/run/docker.sock:ro
      - /mnt/unas/media:/mnt/unas/media:ro
    environment:
      - HOMEPAGE_ALLOWED_HOSTS=homelab:3000,home-server.me
    extra_hosts:
      - "host.docker.internal:host-gateway"
    dns:
      - 1.1.1.1
      - 8.8.8.8
    networks:
      - media-net # Required for widget API calls to reach services by container name (rootless Docker can't route via host ports)

networks:
  media-net:
    external: true # Defined in media-server/compose.yml
