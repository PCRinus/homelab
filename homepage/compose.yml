services:
  homepage:
    image: ghcr.io/gethomepage/homepage:v1.10
    container_name: homepage
    restart: unless-stopped
    env_file:
      - ../.env
    environment:
      - PGID=${DOCKER_GID} # Docker socket GID â€” overrides .env so Homepage can access the socket as non-root
    ports:
      - 3000:3000
    volumes:
      # Versioned configs - read-only
      - ./services.yaml:/app/config/services.yaml:ro
      - ./settings.yaml:/app/config/settings.yaml:ro
      - ./bookmarks.yaml:/app/config/bookmarks.yaml:ro
      - ./docker.yaml:/app/config/docker.yaml:ro
      - ./widgets.yaml:/app/config/widgets.yaml:ro
      - ./custom.css:/app/config/custom.css:ro
      - ./custom.js:/app/config/custom.js:ro
      - ./kubernetes.yaml:/app/config/kubernetes.yaml:ro
      - ./proxmox.yaml:/app/config/proxmox.yaml:ro
      # Container-writable data - not versioned
      - ${DOCKER_DATA}/homepage/logs:/app/config/logs
      # Other mounts
      - ${DOCKER_SOCK}:/var/run/docker.sock:ro
      - ${MEDIA_PATH}:/mnt/unas/media:ro
    extra_hosts:
      - "host.docker.internal:host-gateway"
    dns:
      - 1.1.1.1
      - 8.8.8.8
    networks:
      - media-net # Required for widget API calls to reach services by container name (rootless Docker can't route via host ports)
    healthcheck:
      test: ["CMD", "wget", "-q", "--spider", "http://localhost:3000"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 30s

networks:
  media-net:
    external: true # Defined in media-server/compose.yml
